////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// File: "magnetGun.h"
// Author: Scott Smallback (SS)
// Purpose: handles the magnet gun
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


#pragma once

#include "weapon.h"
#include "../helpers/datatypes.h"
#include "../helpers/criticalsectionmacros.h"

class movingObj;

enum magMode {
	MAG_OFF,
	MAG_PUSH,
	MAG_PULL,
	MAG_HOLD,

	MAG_MODES
};

class mouse;

class magnetGun : public weapon
{
protected:
	float beamWidthFactor;
	mouse* theMouse;
	vector3 pos;
	vector3 aimVect;
	matrix worldMatrix;

	bool getTarget(const vector3& farPoint);
	//float levelLimiter(const vector3& traj);

	CRITICAL_VARS;

	movingObj* target;

	int mode;
	int imgId;
	pt imgCenter;

	void updateWorldMatrix();

public:
	magnetGun();
	~magnetGun();

	//////////////////////////////////////////////////////////////////////////////////////////////////////
	//	Function:		"openFire"
	//	Last Modified:	September 6, 2008
	//	Purpose:		the function to control the firing of the magnet gun
	//////////////////////////////////////////////////////////////////////////////////////////////////////
	virtual void openFire(const vector3* trajectory = 0, int fireMode = 0);

	//////////////////////////////////////////////////////////////////////////////////////////////////////
	//	Function:		"ceaseFire"
	//	Last Modified:	September 6, 2008
	//	Purpose:		stops the magnet gun from being fired
	//////////////////////////////////////////////////////////////////////////////////////////////////////
	virtual void ceaseFire(int dat = 0);

	//////////////////////////////////////////////////////////////////////////////////////////////////////
	//	Function:		"getWidthFactor"
	//	Last Modified:	September 6, 2008
	//	Purpose:		gets the width of the beam
	//////////////////////////////////////////////////////////////////////////////////////////////////////
	float getWidthFactor() const { return beamWidthFactor; }

	//////////////////////////////////////////////////////////////////////////////////////////////////////
	//	Function:		"setWidthFactor"
	//	Last Modified:	September 6, 2008
	//	Purpose:		sets the width of the beam
	//////////////////////////////////////////////////////////////////////////////////////////////////////
	void setWidthFactor(float value) { beamWidthFactor = value; }

	//////////////////////////////////////////////////////////////////////////////////////////////////////
	//	Function:		"update"
	//	Last Modified:	September 6, 2008
	//	Purpose:		updates the gun
	//////////////////////////////////////////////////////////////////////////////////////////////////////
	void update(float dt);

	//////////////////////////////////////////////////////////////////////////////////////////////////////
	//	Function:		"render"
	//	Last Modified:	September 6, 2008
	//	Purpose:		renders the gun
	//////////////////////////////////////////////////////////////////////////////////////////////////////
	void render() const;
};